<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>AssistantAI - Enterprise Financial Intelligence</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet"/>
  <link rel="stylesheet" href="css/main.css" />
</head>
<body>
  <div class="sidebar">
    <div class="logo">
      <h1>AssistantAI</h1>
      <span class="enterprise-badge">Enterprise</span>
    </div>
    <div class="active-consultations">
      <h2>Active Consultations</h2>
      <ul>
        <li class="active">1</li>
      </ul>
    </div>
    <div class="recent-history">
      <h2>Recent History</h2>
      <ul>
        <li>1</li>
      </ul>
    </div>
    <div class="agent-status">Initializing... <span>Vertesia Agent v2.0</span></div>
  </div>

  <div class="main-content">
    <div class="client-banner">
      <div>
        <span class="priority-dot"></span> INCOMING PRIORITY CLIENT
      </div>
      <div class="client-info">
        <div class="client-name">
          <div class="client-initials">JJ</div>
          <div>
            <strong>James Jackson</strong><br />
            Texas University • UT Saver TSA 403(b)
          </div>
        </div>
        <div class="client-tags">
          <span class="tag">High Value</span>
          <span class="tag">35 Years</span>
          <span class="tag">$127K Balance</span>
        </div>
      </div>
      <button id="accept-btn" class="accept-btn">✓ Accept Consultation</button>
    </div>

    <div class="chat-interface" id="chat-interface">
      <div class="chat-messages" id="chat-messages"></div>
      <div class="message-input-container">
        <div class="input-wrapper">
          <input
            type="text"
            class="message-input"
            id="message-input"
            placeholder="Ask about plan details, contributions, or regulations..."
            autocomplete="off"
          />
          <button class="send-btn" id="send-btn">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="22" y1="2" x2="11" y2="13"></line>
              <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
            </svg>
          </button>
        </div>
      </div>
    </div>

    <div class="footer">
      <span>Powered by Vertesia Agent Intelligence</span>
    </div>
  </div>

  <script>
    const messageInput = document.getElementById("message-input");
    const sendBtn = document.getElementById("send-btn");
    const chatMessages = document.getElementById("chat-messages");
    const acceptBtn = document.getElementById("accept-btn");
    const banner = document.querySelector(".client-banner");

    acceptBtn.addEventListener("click", () => {
      banner.style.display = "none";
    });

    function appendMessage(content, sender = "user") {
      const time = new Date().toLocaleTimeString([], { hour: "2-digit", minute: "2-digit" });
      const wrapper = document.createElement("div");
      wrapper.className = sender === "user" ? "message user-message" : "message ai-message";
      wrapper.innerHTML = `
        <div class="message-content">
          <div class="message-text">${content}</div>
          <div class="message-time">${time}</div>
        </div>`;
      chatMessages.appendChild(wrapper);
      chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    async function sendMessage() {
      const text = messageInput.value.trim();
      if (!text) return;
      messageInput.value = "";
      appendMessage(text, "user");

      const loading = document.createElement("div");
      loading.id = "typing";
      loading.innerHTML = `<div class="typing-text">Analyzing request...</div>`;
      chatMessages.appendChild(loading);
      chatMessages.scrollTop = chatMessages.scrollHeight;

      try {
        const res = await fetch("https://muinf.app.n8n.cloud/webhook-test/62377baa-ee4e-4802-9377-ccc0114a159b", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ message: text }),
        });

        const data = await res.json();
        loading.remove();

        const reply = typeof data === "string"
          ? data
          : data.reply || data.message || JSON.stringify(data);

        appendMessage(reply, "ai");
      } catch (err) {
        loading.remove();
        appendMessage("Sorry, there was an error processing your request. Please try again.", "ai");
      }
    }

    sendBtn.addEventListener("click", sendMessage);
    messageInput.addEventListener("keypress", (e) => {
      if (e.key === "Enter") sendMessage();
    });
  </script>
</body>
</html>
